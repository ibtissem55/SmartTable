sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/Text","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/unified/FileUploader","sap/ui/model/Filter","sap/m/library","sap/ui/Device","sap/m/StandardListItem","sap/m/SearchField","sap/ui/export/Spreadsheet","sap/m/List","sap/m/Dialog","sap/m/MessageBox","sap/ui/model/FilterOperator","sap/ui/table/Table","sap/ui/commons/Label","sap/ui/core/Fragment","sap/m/Button"],function(e,t,a,s,o,i,n,r,l,g,u,d,h,p,c,f,m,y,v){"use strict";var b;return e.extend("smartTable.SmartTable.controller.Mtable",{onInit:function(){b=this;var e=sap.ui.getCore().getMessageManager(),t=e.getMessageModel(),a=t.bindList("/",undefined,[],new d("technical",h.EQ,true)),s=new sap.ui.model.json.JSONModel({busy:false,hasUIChanges:false,solutionEmpty:true,order:0});this.getView().setModel(s,"appView");this.getView().setModel(t,"message");a.attachChange(this.onMessageBindingChange,this);this._bTechnicalErrors=false},onOpenFormDialog:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("add")},handleUploadPress:function(e){var a=sap.ui.getCore().byId("dialogBranch").getSelectedItem().getText();var s=sap.ui.getCore().byId("dialogSolution").getSelectedItem().getText();if(e.getSource().getParent().getBindingContext().getProperty("Solution")){this.getView().getModel("appView").setProperty("/solutionEmpty",false)}var o=this.getView().byId("smartTab");var i=sap.ui.getCore().byId("fileUploader");i.upload();if(!i.getValue()){t.show("choose a file first");return}else{sap.ui.getCore().fileUploadArr=[];var n=i.getFocusDomRef().files[0];if(n&&window.FileReader){var r=new FileReader;r.onload=function(e){var t=e.target.result;var i=new Uint8Array(t);var n="";for(var r=0;r<i.byteLength;r++){n+=String.fromCharCode(i[r])}var l=XLSX.read(n,{type:"binary"});var g=l.SheetNames[0];var u=l.Sheets[g];var d=XLSX.utils.sheet_to_json(u,{raw:true});var h=new sap.ui.model.json.JSONModel;for(var p=0;p<d.length;++p){d[p]["Branch"]=a;d[p]["Solution"]=s;d[p]["Status"]="Draft"}h.setData(d);o.setModel(h,"oModelMNA");var c=o.getTable();var f=c.getColumns();for(var m=0;m<f.length;m++){var y="oModelMNA>"+f[m].data("p13nData").columnKey;y=y.replace("_"," ");f[m].getTemplate().getDisplay().bindText(y);f[m].getTemplate().getEdit().bindValue(y)}debugger;c.bindRows("oModelMNA>/");b._setUIChanges(true)};r.readAsArrayBuffer(n);this._getDialog().close()}}},_getDialog:function(){if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("smartTable.SmartTable.view.Dialog",this);this.getView().addDependent(this._oDialog)}return this._oDialog},onOpenDialog:function(){this._getDialog().open()},onCloseDialog:function(){this._getDialog().close()},onButtonPress:function(e){var t=e.getSource();b.byId("actionSheet").openBy(t)},onWorkPCackagePress:function(e){var t=e.getSource();b.byId("actionWP").openBy(t)},solutionBranch:function(e){var t=e.getSource().getProperty("selectedKey");var a=sap.ui.getCore().byId("dialogBranch");var s="/solutionsSet('"+t.toString()+"')/SolutionBranch";a.setSelectedKey(null);var o=sap.ui.getCore().byId("itemBranch");var i=sap.ui.getCore().byId("dialogSolution");a.setSelectedKey(null);this.getOwnerComponent().getModel().read(s,{success:function(e){var t=e.results;if(t.length!=0){a.setEnabled(true);a.bindItems({path:s,template:o,templateShareable:true})}else{a.setSelectedKey(undefined);i.setSelectedKey(null);a.setEnabled(false);sap.m.MessageBox.error("Choose a Solution with Design Branch",{title:"Error",onClose:null,styleClass:"",actions:sap.m.MessageBox.Action.Close,emphasizedAction:null,initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit});return}}})},_setBusy:function(e){var t=this.getView().getModel("appView");t.setProperty("/busy",e)},_setUIChanges:function(e){if(this._bTechnicalErrors){e=true}else if(e===undefined){e=this.getView().getModel().hasPendingChanges()}var t=this.getView().getModel("appView");t.setProperty("/hasUIChanges",e)},onSave:function(){var e=function(){this._setBusy(false);t.show(this._getText("changesSentMessage"));this._setUIChanges(false)}.bind(this);var a=function(e){this._setBusy(false);this._setUIChanges(false);l.error(e.message)}.bind(this);b._setBusy(true);b.getView().getModel().submitChanges(e,a);b._bTechnicalErrors=false},onInputChange:function(e){if(e.getParameter("escPressed")){this._setUIChanges()}else{this._setUIChanges(true);if(e.getSource().getParent().getBindingContext().getProperty("Solution")){b.getView().getModel("appView").setProperty("/solutionEmpty",false)}}}})});